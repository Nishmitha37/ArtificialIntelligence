import re

def is_variable(x):
    return isinstance(x, str) and x[0].islower()

def is_constant(x):
    return isinstance(x, str) and x[0].isupper()

def occurs_check(var, expr):
    """Check if variable occurs in expression"""
    if var == expr:
        return True
    if isinstance(expr, list):
        return any(occurs_check(var, sub) for sub in expr)
    return False

def substitute(expr, subs):
    """Apply substitutions to expression"""
    if isinstance(expr, str):
        return subs.get(expr, expr)
    elif isinstance(expr, list):
        return [substitute(sub, subs) for sub in expr]
    return expr

def unify(x, y, subs=None):
    """Main unification function"""
    if subs is None:
        subs = {}

    x = substitute(x, subs)
    y = substitute(y, subs)

    # Identical
    if x == y:
        return subs

    # Variable cases
    if is_variable(x):
        if occurs_check(x, y):
            return None
        subs[x] = y
        return subs

    if is_variable(y):
        if occurs_check(y, x):
            return None
        subs[y] = x
        return subs

    # Compound terms
    if isinstance(x, list) and isinstance(y, list):
        if len(x) != len(y):
            return None
        for i in range(len(x)):
            subs = unify(x[i], y[i], subs)
            if subs is None:
                return None
        return subs

    return None

def parse_expression(expr):
    """Convert 'Knows(John, x)' â†’ ['Knows', 'John', 'x']"""
    expr = expr.strip()
    match = re.match(r'(\w+)\((.*)\)', expr)
    if match:
        func = match.group(1)
        args = [arg.strip() for arg in match.group(2).split(',')]
        return [func] + args
    else:
        return [expr]


if __name__ == "__main__":
    expr1_str = input("Enter first expression: ")
    expr2_str = input("Enter second expression: ")

    expr1 = parse_expression(expr1_str)
    expr2 = parse_expression(expr2_str)

    result = unify(expr1, expr2)

    print("\nExpression 1:", expr1)
    print("Expression 2:", expr2)

    print("\nUnification Result:")
    if result:
        print(result)
    else:
        print("Failure to unify.")

